function resize(){var t=document.getElementById("nBodyCanvas");SCREEN_X=t.clientWidth,SCREEN_Y=t.clientHeight,t.width=SCREEN_X,t.height=SCREEN_Y}let GRAVITATIONAL_CONSTANT=6.67*Math.pow(10,-11),NUM_PARTICLES=50,TIME_STEP=.0015,TARGET_FPS=120,MAX_VELOCITY=2e3,PARTICLE_MAX_MASS=1.5,PARTICLE_MIN_MASS=.5,MOUSE_PARTICLE_MASS=15,MAX_NUMBER_PREV_POSITIONS=30,WRAP_AROUND=!1;var canvas=document.getElementById("nBodyCanvas");let SCREEN_X=canvas.clientWidth,SCREEN_Y=canvas.clientHeight;canvas.width=canvas.clientWidth,canvas.height=canvas.clientHeight;let PARTICLE_SIZE=Math.min(SCREEN_X,SCREEN_Y)/800*7.5;class Vector{constructor(t,e){this.x=t,this.y=e}multiplyScalar(t){return new Vector(t*this.x,t*this.y)}addVectors(t){return new Vector(this.x+t.x,this.y+t.y)}addVectorMut(t){this.x+=t.x,this.y+=t.y}subtractVectors(t){return new Vector(this.x-t.x,this.y-t.y)}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}distance(t){return this.subtractVectors(t).magnitude()}}class Particle{constructor(t,e,s){this.mass=t,this.position=new Vector(e,s),this.velocity=new Vector(0,0),this.force=new Vector(0,0),this.previousPos=[],this.color="#"+((1<<24)*Math.random()|0).toString()}addPosition(){this.previousPos.length>=MAX_NUMBER_PREV_POSITIONS&&this.previousPos.shift(),this.previousPos.push(this.position)}getSize(){return Math.sqrt(Math.abs(this.mass))*PARTICLE_SIZE}}class NBody{constructor(t){this.particles=[],this.camera=new Vector(0,0);for(let e=0;e<t;e++){let t=new Particle(PARTICLE_MIN_MASS+Math.random()*(PARTICLE_MAX_MASS-PARTICLE_MIN_MASS),Math.random()*SCREEN_X,Math.random()*SCREEN_Y);this.particles.push(t)}}handleCollisions(){for(let t=0;t<this.particles.length;t++)for(let e=t+1;e<this.particles.length;e++){let s=this.particles[t],i=this.particles[e];if(s.position.distance(i.position)<1.75*Math.abs(s.getSize()-i.getSize())){let t=s.mass>i.mass?s:i,e=t!=s?s:i;this.particles.splice(this.particles.indexOf(e),1),t.velocity=s.velocity.multiplyScalar(s.mass).addVectors(i.velocity.multiplyScalar(i.mass)).multiplyScalar(1/(s.mass+i.mass)),t.mass+=e.mass}}}updateForces(){for(let t=0;t<this.particles.length;t++)for(let e=t+1;e<this.particles.length;e++){let s=this.particles[t],i=this.particles[e],a=s.position,o=i.position,r=a.subtractVectors(o),l=-1*s.mass*i.mass*GRAVITATIONAL_CONSTANT*Math.pow(r.magnitude(),3),c=r.multiplyScalar(l);s.force=s.force.addVectors(c),i.force=i.force.addVectors(c.multiplyScalar(-1))}}setCamera(t){var e=0,s=new Vector(0,0);for(let t=0;t<this.particles.length;t++){let i=this.particles[t];e+=i.mass,s.addVectorMut(i.position.multiplyScalar(i.mass))}let i=(s=(s=s.multiplyScalar(1/e)).subtractVectors(new Vector(SCREEN_X/2,SCREEN_Y/2))).subtractVectors(this.camera);this.camera=this.camera.addVectors(i.multiplyScalar(.05))}moveParticles(t){for(let e=0;e<this.particles.length;e++){let s=this.particles[e],i=s.force.multiplyScalar(1/s.mass).multiplyScalar(t/2);s.velocity=s.velocity.addVectors(i);let a=s.velocity.multiplyScalar(t);s.position=s.position.addVectors(a),WRAP_AROUND&&(s.position.x<0&&(s.position.x+=SCREEN_X),s.position.x>SCREEN_X&&(s.position.x-=SCREEN_X),s.position.y<0&&(s.position.y+=SCREEN_Y),s.position.y>SCREEN_Y&&(s.position.y-=SCREEN_Y)),s.addPosition(),s.velocity.magnitude()>MAX_VELOCITY&&(s.velocity=s.velocity.multiplyScalar(MAX_VELOCITY/s.velocity.magnitude()))}}step(t,e){this.updateForces(),this.moveParticles(t),this.handleCollisions(),this.setCamera(e)}}class Drawer{drawArrow(t,e,s,i,a,o,r){var l=i-e,c=a-s,n=Math.atan2(c,l);t.strokeStyle=r,t.beginPath(),t.moveTo(e,s),t.lineTo(i,a),t.lineTo(i-o*Math.cos(n-Math.PI/6),a-o*Math.sin(n-Math.PI/6)),t.moveTo(i,a),t.lineTo(i-o*Math.cos(n+Math.PI/6),a-o*Math.sin(n+Math.PI/6)),t.stroke()}drawPath(t,e,s,i,a){for(let o=0;o<e.previousPos.length-1;o++){let r=e.previousPos[o].subtractVectors(a),l=e.previousPos[o+1].subtractVectors(a);r.distance(e.position.subtractVectors(a))<s||(Math.abs(r.x-l.x)>SCREEN_X/3||Math.abs(r.y-l.y)>SCREEN_Y/3||(t.globalAlpha=o/e.previousPos.length,t.strokeStyle=i,t.fillStyle=i,t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(l.x,l.y),t.stroke(),t.fill()))}}drawParticles(t,e){if(canvas.getContext){var s=canvas.getContext("2d");s.clearRect(0,0,canvas.width,canvas.height);for(let i=0;i<t.length;i++){let a=t[i],o=a.position.x-e.x,r=a.position.y-e.y,l=a.getSize();if(s.fillStyle=a.color,s.strokeStyle="black",WRAP_AROUND){if(o<5||o>SCREEN_X-5)continue;if(r<5||r>SCREEN_Y-5)continue}s.beginPath(),s.arc(o,r,l,0,2*Math.PI,!0),s.globalAlpha=1,s.stroke(),s.globalAlpha=.55,s.fill(),this.drawPath(s,a,l,a.color,e)}}}}let simulation=new NBody(NUM_PARTICLES),drawer=new Drawer(NUM_PARTICLES);var frame=0,intervalId=window.setInterval(function(){simulation.step(TIME_STEP,frame),drawer.drawParticles(simulation.particles,simulation.camera),frame+=1},1e3/TARGET_FPS);window.onresize=resize;